# 原神圣遗物狗粮锄地路线优化
## 简介 | Introduction
本项目是一个用于优化原神圣遗物狗粮路线的 R 语言脚本。通过混合整数规划（MIP）算法，结合自定义参数和地图点位数据，自动计算出最优的采集路线，最大化狗粮、摩拉等资源的获取效率。脚本支持多种自定义需求，如排除/指定点位、舒适度惩罚、多人协作等场景。

主要的数据收集工作由我独立完成，并由NGA众坛友补充，在此感谢！特别感谢 @彼音星垠 对本项目的大力支持！

基准速度测试基于全四星队伍，如罗-风-早-亚，5.6以来改为罗欧早伊，记录了每一条圣遗物路线的跑图耗时（可在data文件夹中的路线设计文件查看）

## 特性 | Features
- 支持两种优化目标（狗粮经验、摩拉+狗粮经验）
- 支持排除/指定点位、路线
- 支持舒适度参数、地图惩罚参数调整
- 支持多种跑图模式（单人、多人、AB路线不重叠等）
- 支持12小时点位复用

## 依赖 | Dependency
本程序基于R语言编写，使用前请确保已安装以下 R 包：

```R
install.packages(c(
  "tidyverse",
  "readxl",
  "ompr",
  "ompr.roi",
  "ROI.plugin.glpk",
  "clipr"
))
```
## 数据说明 | Data Description
- `data/artifact-drop-spots.xlsx` ：
    > 包含所有圣遗物狗粮点位的详细信息
- `data/artifact-farming-routes.xlsx` ：
    > 包含预设的采集路线设计

## 核心程序说明 | Optim-func Usage

### 1.`GeneralPlanning()`

#### `n_pts`
> 指在ban/pick点位路线之外需要采集多少点，默认为99。
#### `...`
> 额外传递给`getRouteData()`函数的参数，具体说明见下一节。

#### `use.mount`
> 布尔值，是否使用口袋锚点，默认不使用。

#### `target`
> 字符型，表明本次计算的优化目标，要么为"狗粮经验"、表明只在乎获取的圣遗物狗粮（默认），要么为"综合收益"、表示综合考虑圣遗物狗粮以及摩拉获取。

#### `ban_P`
> 字符型，用于指定不想采用的圣遗物狗粮点位，不同点位之间用`|`分割，支持正则。圣遗物点位名称需要与`- data/点位描述.xlsx`中记录的一致。

#### `pick_P`
> 字符型，用于指定必选的圣遗物狗粮点位，一般用于指定收尾路线。不同点位之间用`|`分割，支持正则。圣遗物点位名称需要与`- data/点位描述.xlsx`中记录的一致。注意，如果你指定了收尾路线以外的点位，需要对应修改`n_pts`参数以免计算结果出错。

#### `no_2nd_use`
> 字符型，用于指定不需要重复使用的圣遗物狗粮快速刷新点位，一般用于计算配套副路线时，过滤掉不想重复使用的段刷新周期点位。

#### `flex`
> 数值型，0.5~1之间，用于给出最高速度路线的收益约束。这涉及到本优化程序的逻辑：首先根据指定过滤条件计算出收益最大的跑法，然后根据不同flex下的收益宽容度（如80%最大收益），挑选对应收益目标下的最高速路线。默认flex水平为0.8。

#### `drop_least_eff`:
> 布尔值，是否排除掉30%百分位以下效率的路线，默认过滤以精简计算。但当备选点数特别少的时候，需要改成`FALSE`

### 2.`getRouteData()`

#### `...`
> 传送给`getPointData()`函数的额外参数，参见下一节。

#### `pun_comf`
> 舒适度惩罚，数值型，默认为4，将旁边有不舒适的要素（混杂点、怪物、读书点）的点位路线进行时间降权的参数，越高表明越不想碰上不舒适要素，越小表明不在乎这些不舒适点。

#### `pun_map`
> 舒适度惩罚，数值型，默认为4，将处在独立地图中的点位路线进行时间降权的参数，越高表明越不想使用切换功能访问独立地图，越小表明不在乎。

#### `t_teleport`
> 预计传送时间，数值型，默认为6，为每一条路线进行效率计算时考虑的传送所花时间。越高表明传送时间越长，因此短链路线的权重会受影响，越小表明不在乎传送时间。

#### `block_lvl`
> 封锁水平，由我本人经验设定的访问这些圣遗物狗粮点的难易程度，比如说往昔的桓纳兰那这边的几个点都需要做完森林书才能够开启地图进入，因此封锁水平是10，其他没要求的露天点位封锁等级为0.

#### `reuse12`
> 布尔值，反映是否想重复使用短周期点位，仅当在配合计算副路线时有用。

### 3.`getPointData()`

#### `Map`
> 地图筛选参数，默认Map为`""`表示获取全部点位信息；Map海克威为"全部地表"：只保留六大主地图的数据；Map以"no"开头：排除指定主地图的数据；Map为其他非空值：只保留指定主地图的数据。地图的筛选需要依照`data/artifact-drop-spots.xlsx`中主地图一列的名称，支持`|`符号分割地图。

## Supporting Information
具体点位名称、位置、刷新时间、掉落等信息请见[我的NGA版头贴](https://nga.178.com/read.php?tid=27875210)

一些现成的跑图路线攻略视频请见我的[Bilibili主页](https://space.bilibili.com/1897138)
